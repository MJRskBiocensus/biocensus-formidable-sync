(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function i(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(i)?i:i+""}var r=function(){return e=function e(t,i,r,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof HTMLElement||(t=document.querySelector(t)),this.wrapper=t,this.timelineWrapper=r,this.timelineType=n,this.data=frmViewsTimeline.entries,this.settings=frmViewsTimeline.settings,this.containerWidth=i,this.isOpen=!1,document.addEventListener("click",(function(e){e.target.closest(".frm-timeline-view--content-box")||o.close()}),{passive:!0})},(i=[{key:"open",value:function(e,t,i){this.isOpen=!0,"vertical"===this.timelineType?this.makeVerticalPosition(i,t):this.makeHorizontalPosition(t),this.addContent(e),this.wrapper.classList.add("frm-timeline-view--detail-popup-open")}},{key:"makeHorizontalPosition",value:function(e){var t=e.getBoundingClientRect(),i=this.timelineWrapper.getBoundingClientRect(),r=t.right-i.left+this.timelineWrapper.scrollLeft+20,n=t.top-i.top+this.timelineWrapper.scrollTop;this.wrapper.style.top="".concat(n,"px"),this.wrapper.style.left="".concat(r,"px"),this.wrapper.style.right="auto"}},{key:"makeVerticalPosition",value:function(e,t){if(this.wrapper.classList.remove("frm-timeline-view--detail-popup-right"),this.wrapper.style.top="".concat(t.offsetTop,"px"),"left"===e){var i=t.offsetWidth+t.offsetLeft+20;return this.wrapper.style.left="".concat(i,"px"),void(this.wrapper.style.right="auto")}var r=this.containerWidth-t.offsetWidth-this.wrapper.offsetWidth-20;this.wrapper.style.left="".concat(r,"px"),this.wrapper.classList.add("frm-timeline-view--detail-popup-right")}},{key:"addContent",value:function(e){var t=this.data.find((function(t){return t.id===e}));this.wrapper.innerHTML=t.detail_content}},{key:"close",value:function(){this.isOpen=!1,this.wrapper.classList.remove("frm-timeline-view--detail-popup-open"),this.wrapper.innerHTML=""}}])&&t(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i}();function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function a(e,t,i){return t=c(t),l(e,s()?Reflect.construct(t,i||[],c(e).constructor):t.apply(e,i))}function l(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(s=function(){return!!e})()}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function p(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var v=function(){return p((function e(t){u(this,e),this.timelineType="vertical",this.wrapper=t,this.container=document.querySelector(".frm-timeline-view-container"),this.trackerLine=document.querySelector(".frm-timeline-view--tracker-line"),this.eventMarkerType=this.wrapper.dataset.eventMarkerType,this.divider=this.wrapper.dataset.divider,this.settings=frmViewsTimeline.settings,this.dividerItems=[],this.lastScrollY=0}),[{key:"init",value:function(){var e=this;this.containerRect=this.container.getBoundingClientRect(),this.containerWidth=this.container.offsetWidth,this.containerHeight=this.container.offsetHeight,this.markers=[],this.timelineItems=[],this.detailsPopup=new r(".frm-timeline-view--detail-popup",this.containerWidth,this.wrapper,this.timelineType);var t=this.container.querySelectorAll(".frm-timeline-view--marker"),i=this.container.querySelectorAll(".frm-timeline-view--item");1===parseInt(this.divider,10)&&this.container.querySelectorAll(".frm-timeline-view--divider").forEach((function(t){e.dividerItems.push({rect:t.getBoundingClientRect(),topOffset:t.offsetTop,element:t})})),t.forEach((function(t){e.markers.push(e.getMarkerData(t))})),i.forEach((function(t){var i=t.querySelector(".frm-timeline-view--content-box");e.initDetailsPopup(i,t);var r={rect:t.getBoundingClientRect(),topOffset:t.offsetTop,element:t,even:t.dataset.even,first:{element:t.querySelectorAll(".frm-timeline-view--animate-first"),children:t.querySelectorAll(".frm-timeline-view--animate-first > *")},second:{element:t.querySelectorAll(".frm-timeline-view--animate-second"),contentBox:i,contentBoxChildren:t.querySelectorAll(".frm-timeline-view--content-box > *")}};e.timelineItems.push(r)}))}},{key:"initDetailsPopup",value:function(e,t){var i=this;if(1===parseInt(this.settings.show_details_popup,10)){var r="true"===t.dataset.even?"left":"right";e.addEventListener("click",(function(){if(e.dataset.popupOpened&&"true"===e.dataset.popupOpened)return e.dataset.popupOpened=!1,void i.detailsPopup.close();e.dataset.popupOpened=!0,i.detailsPopup.open(t.dataset.id,e,r)}))}}},{key:"getMarkerData",value:function(e){var t={rect:e.getBoundingClientRect(),topOffset:e.offsetTop,element:e,circumference:null,activeSvg:null,icon:null};return"dots"===this.eventMarkerType?(t.icon=e.querySelector(".frm-timeline-view--marker-dot-icon"),t):(t.activeSvg=e.querySelector(".frm-timeline-view--marker-svg-active"),t.activeSvg?(t.circumference="small"===frmViewsTimeline.style.marker_icon_size?120:2*Math.PI*e.offsetWidth/2,t.activeSvg.style.strokeDasharray=t.circumference,t.activeSvg.style.strokeDashoffset=t.circumference,t.icon=e.querySelector(".frm-timeline-view--marker-icon"),t):t)}},{key:"handleScroll",value:function(){var e=Math.round(Math.max(0,window.scrollY-this.containerRect.top/16)),t=Math.round(1*e)+120;(t=Math.min(t,this.containerHeight))===this.containerHeight?this.container.classList.add("frm-animation-ended"):this.container.classList.remove("frm-animation-ended"),this.stopTrackerLineAnimation(t)&&"up"!==this.scrollDirection()||(this.trackerLine.style.height="".concat(t,"px")),this.detectActiveMarker(t),this.detectDividers(t)}},{key:"getScrollTop",value:function(){return Math.round(Math.max(0,window.scrollY-this.containerRect.top/16))}},{key:"detectDividers",value:function(e){1===parseInt(this.divider,10)&&this.dividerItems.forEach((function(t){e>=t.topOffset?t.element.classList.add("frm-timeline-view--divider-active"):t.element.classList.remove("frm-timeline-view--divider-active")}))}},{key:"stopTrackerLineAnimation",value:function(e){return this.timelineItems.some((function(t){return e>=t.topOffset+t.rect.height/2&&e<=t.topOffset+1.2*t.rect.height}))}},{key:"detectActiveMarker",value:function(e){var t=this;this.markers.forEach((function(i,r){e>=i.topOffset?(i.element.classList.add("frm-timeline-view--marker-active"),i.element.closest(".frm-timeline-view--item").classList.add("frm-timeline-view--item-active"),t.animateMarker(e,i),t.animateItems(e,i,r)):(i.element.classList.remove("frm-timeline-view--marker-active"),i.element.closest(".frm-timeline-view--item").classList.remove("frm-timeline-view--item-active"))}))}},{key:"animateMarker",value:function(e,t){var i=this.getProgressBasedOnMarkerDimensions(e,t);if(t.activeSvg){var r=i*t.circumference*2;t.activeSvg.style.opacity=12*i<.3?0:12*i,t.activeSvg.style.strokeDashoffset=Math.max(0,t.circumference-r)}if(t.icon){var n=Math.min(1,2.2*i);t.icon.style.opacity=n<.3?0:n,t.icon.style.transform="scale( ".concat(n," )")}}},{key:"animateItems",value:function(e,t,i){var r=4*this.getProgressBasedOnMarkerDimensions(e,t),n=this.timelineItems[i];if(n.element){var o=Math.max(1,1.8-1.8*r),a=Math.min(0,.0029*r-.0029),l=Math.max(1,1.74-1.74*r),s=Math.min(0,5*r-5),c=Math.min(0,5*r-5),m=Math.max(0,4-4*r),f=this.wrapper.classList.contains("frm-timeline-view--theme-life-events")?"rotate( ".concat(Math.min(5,5*r),"deg )"):"",u="matrix3d( ".concat(o,", 0, 0, 0, 0, ").concat(o,", 0, ").concat(a,", 0, 0, ").concat(o,", 0, 0, 0, 0, ").concat(l," )"),h="translate( ".concat(s,"px, ").concat(c,"px )");n.first.children.forEach((function(e){e.style.transform=u+" "+h+" "+f,e.style.opacity=r<.3?0:r,e.style.filter="blur( ".concat(m,"px )")})),n.second.contentBox.style.opacity=2*r,this.contentBoxScale(r,n),r>.98?n.second.contentBox.classList.add("frm-timeline-view--content-box-active"):n.second.contentBox.classList.remove("frm-timeline-view--content-box-active")}}},{key:"contentBoxScale",value:function(e,t){var i=Math.min(1,e);t.second.contentBox.style.transform="scaleY( ".concat(i," )")}},{key:"getProgressBasedOnMarkerDimensions",value:function(e,t){return Math.max(0,e-t.topOffset)*t.rect.height/100/100}},{key:"scrollDirection",value:function(){var e="down";return window.scrollY<this.lastScrollY&&(e="up"),this.lastScrollY=window.scrollY,e}}])}(),y=function(e){function t(){var e;return u(this,t),(e=a(this,t,[document.querySelector(".frm-timeline-view--wrapper")])).firstItemScrollTop=0,e.wrapper&&e.eventMarkerType&&e.container&&e.trackerLine?(e.init(),e.showFirstItem(),window.addEventListener("scroll",(function(){window.requestAnimationFrame((function(){window.scrollY>e.firstItemScrollTop&&e.handleScroll()}))}),{passive:!0}),wp.hooks.addFilter("frm_views_pagination_after_load_page","formidable",(function(t){var i=document.querySelector(".frm-timeline-view--content");return i.innerHTML+=t.html,e.init(),{wrapper:i,appendContentOnly:!0}})),e):l(e)}return m(t,e),p(t,[{key:"showFirstItem",value:function(){this.firstItemScrollTop=this.markers[0].topOffset;var e=Math.round(1*this.firstItemScrollTop)+120;e=Math.min(e,this.containerHeight),this.trackerLine.style.height="".concat(e,"px"),this.markers[0].element.classList.add("frm-timeline-view--marker-active"),this.markers[0].element.closest(".frm-timeline-view--item").classList.add("frm-timeline-view--item-active"),this.animateMarker(e,this.markers[0]),this.animateItems(e,this.markers[0],0)}}])}(v),w=function(e){function t(){var e;return u(this,t),(e=a(this,t,[document.querySelector(".frm-timeline-view--horizontal")])).timelineType="horizontal",e.lastScrollX=0,e.scrollLeftSpeed=.6,e.scrollStarted=!1,e.isOverTimeline=!1,e.scrollDirection={x:"right",y:"down"},e.wrapper&&e.trackerLine&&e.container?(e.init(),e.adjustContainerHeight(),e.showFirstItem(),e.horizontalRect=e.wrapper.getBoundingClientRect(),e.containerPadding=e.wrapper.offsetWidth/2,e.container.style.paddingRight="".concat(e.containerPadding,"px"),window.addEventListener("keydown",(function(t){return e.handleTheScrollOnKeypress(t)})),window.addEventListener("scroll",(function(t){return e.allowOrBlockVerticalScroll(t)}),{passive:!1}),window.addEventListener("wheel",(function(t){return e.triggerHorizontalScroll(t)}),{passive:!1}),e.wrapper.addEventListener("scroll",(function(){return e.handleScrollOnMobile()})),wp.hooks.addFilter("frm_views_pagination_disable_scroll_events","formidable",(function(){return!0})),wp.hooks.addFilter("frm_views_pagination_after_load_page","formidable",(function(t){var i=document.querySelector(".frm-timeline-view--content");return i.innerHTML+=t.html,e.init(),{wrapper:i,appendContentOnly:!0}})),e):l(e)}return m(t,e),p(t,[{key:"isMobile",value:function(){return window.innerWidth<768}},{key:"handleScrollOnMobile",value:function(){this.isMobile()&&this.handleScroll()}},{key:"allowOrBlockVerticalScroll",value:function(e){var t=this;window.requestAnimationFrame((function(){t.setScrollDirection(),t.timelineIsInViewport()?t.wrapper.classList.contains("frm-timeline-view--item-middle")||(t.wrapper.classList.add("frm-timeline-view--item-middle"),t.isOverTimeline=!0,e.preventDefault()):window.scrollY<t.horizontalRect.top&&t.isOverTimeline&&t.scrollStarted&&(t.wrapper.classList.remove("frm-timeline-view--item-middle"),t.isOverTimeline=!1,t.scrollStarted=!1)}))}},{key:"handleTheScrollOnKeypress",value:function(e){if("ArrowDown"===e.key||"ArrowUp"===e.key)if(!this.isOverTimeline||this.shouldReleaseScrollOnScrollUp()||this.horizontalScrollEnded())this.horizontalScrollEnded()&&this.isOverTimeline&&(this.isOverTimeline=!1,this.wrapper.classList.remove("frm-timeline-view--item-middle"));else{(this.isOverTimeline||"ArrowDown"===e.key)&&(this.scrollStarted=!0);var t="ArrowDown"===e.key?50:-50;this.wrapper.scrollLeft+=t,this.handleScroll(),e.preventDefault()}}},{key:"triggerHorizontalScroll",value:function(e){var t=this;Math.abs(e.deltaY)<Math.abs(e.deltaX)?e.preventDefault():!this.isOverTimeline||this.shouldReleaseScrollOnScrollUp()||this.horizontalScrollEnded()||(e.preventDefault(),this.scrollStarted=!0,window.requestAnimationFrame((function(){window.scrollTo(0,t.lastScrollY),t.wrapper.scrollLeft+=e.deltaY*t.scrollLeftSpeed,t.handleScroll()})))}},{key:"showFirstItem",value:function(){var e=Math.round(this.markers[0].rect.left-this.containerRect.left)+120;e=Math.min(e,this.containerWidth),this.trackerLine.style.width="".concat(e,"px"),this.markers[0].element.classList.add("frm-timeline-view--marker-active"),this.markers[0].element.closest(".frm-timeline-view--item").classList.add("frm-timeline-view--item-active"),this.animateMarker(e,this.markers[0]),this.animateItems(e,this.markers[0],0)}},{key:"adjustContainerHeight",value:function(){var e,t=Math.max.apply(Math,function(e){if(Array.isArray(e))return o(e)}(e=this.timelineItems.map((function(e){return e.second.element[0].clientHeight})))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());this.container.style.height="".concat(2*t+120,"px")}},{key:"detectDividers",value:function(e){var t=this;1===parseInt(this.divider,10)&&this.dividerItems.forEach((function(i){e>=i.rect.left-t.containerRect.left?i.element.classList.add("frm-timeline-view--divider-active"):i.element.classList.remove("frm-timeline-view--divider-active")}))}},{key:"handleScroll",value:function(){var e=Math.round(Math.max(0,this.wrapper.scrollLeft+350)),t=Math.round(1.1*e)+120;t=Math.min(t,this.containerWidth),this.stopTrackerLineAnimation(t)&&"left"!==this.getScrollDirection().x||(this.trackerLine.style.width="".concat(t,"px")),t+this.containerPadding>this.containerWidth?(this.maybeLoadNextPage(),this.wrapper.classList.add("frm-animation-ended")):this.wrapper.classList.remove("frm-animation-ended"),this.detectActiveMarker(t),this.detectDividers(t)}},{key:"stopTrackerLineAnimation",value:function(e){var t=this;return"left"!==this.getScrollDirection().x&&this.timelineItems.some((function(i){return e>=i.rect.left-t.containerRect.left+i.rect.width/2&&e<=i.rect.left-t.containerRect.left+1.2*i.rect.width}))}},{key:"detectActiveMarker",value:function(e){var t=this;this.markers.forEach((function(i,r){e>=i.rect.left-t.containerRect.left?(i.element.classList.add("frm-timeline-view--marker-active"),i.element.closest(".frm-timeline-view--item").classList.add("frm-timeline-view--item-active"),t.animateMarker(e,i),t.animateItems(e,i,r)):(i.element.classList.remove("frm-timeline-view--marker-active"),i.element.closest(".frm-timeline-view--item").classList.remove("frm-timeline-view--item-active"))}))}},{key:"contentBoxScale",value:function(e,t){var i=Math.min(1,e);t.second.contentBox.style.transform="scaleX( ".concat(i," )")}},{key:"getProgressBasedOnMarkerDimensions",value:function(e,t){return Math.max(0,e-t.rect.left+this.containerRect.left)*t.rect.width/100/100}},{key:"timelineIsInViewport",value:function(){var e=window.innerHeight,t=window.scrollY+e/2,i=this.horizontalRect.top+this.horizontalRect.height/2;return i>=t-90&&i<=t+90}},{key:"isAtEndOfScroll",value:function(){return Math.abs(this.wrapper.scrollLeft+this.wrapper.offsetWidth-this.wrapper.scrollWidth)<=1}},{key:"shouldReleaseScrollOnScrollUp",value:function(){return 0===this.wrapper.scrollLeft&&this.scrollStarted}},{key:"horizontalScrollEnded",value:function(){return this.isAtEndOfScroll()&&"down"===this.getScrollDirection().y}},{key:"setScrollDirection",value:function(){this.scrollDirection={x:"right",y:"down"},window.scrollX<this.lastScrollX&&(this.scrollDirection.x="left",this.scrollDirection.y="down"),window.scrollY<this.lastScrollY&&(this.scrollDirection.y="up"),this.lastScrollX=window.scrollX,this.lastScrollY=window.scrollY}},{key:"getScrollDirection",value:function(){return this.scrollDirection}},{key:"hasPagination",value:function(){return null!==this.wrapper.nextElementSibling&&this.wrapper.nextElementSibling.classList.contains("frm_ajax_pagination_cont")}},{key:"maybeLoadNextPage",value:function(){this.hasPagination()&&this.wrapper.nextElementSibling.querySelector(".frm-ajax-pagination-load-more").click()}}])}(v);function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function S(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function g(e){var t=function(e,t){if("object"!=k(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}var b=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"init",value:function(){this.hasAnyElement([".frm-timeline-view--vertical",".frm-timeline-view--vertical-right",".frm-timeline-view--vertical-left"])&&new y,this.hasAnyElement([".frm-timeline-view--horizontal",".frm-timeline-view--horizontal-top",".frm-timeline-view--horizontal-bottom"])&&new w}},{key:"hasAnyElement",value:function(e){return e.some((function(e){return document.querySelector(e)}))}}],null&&S(e.prototype,null),t&&S(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();document.addEventListener("DOMContentLoaded",(function(){return b.init()}))})();